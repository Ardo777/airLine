<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request</title>

    <link href="/staticAdminManager/css/bootstrap.min.css" rel="stylesheet">
    <link href="/staticAdminManager/font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="/staticAdminManager/css/plugins/slick/slick.css" rel="stylesheet">
    <link href="/staticAdminManager/css/plugins/slick/slick-theme.css" rel="stylesheet">
    <link href="/staticAdminManager/css/animate.css" rel="stylesheet">
    <link href="/staticAdminManager/css/style.css" rel="stylesheet">
    <link rel="shortcut icon" type="image/x-icon" href="/media/favicon.png">
</head>
<style>
    .bigger-icon {
        font-size: 24px;
    }

    .bigger-icon i {
        font-size: 20px;
    }

    .container {
        width: 100%;
        height: 68px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .centered-button {
        background-color: #2e4b64;
        border: none;
        color: white;
        padding: 8px 14px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 14px;
        border-radius: 4px;
        transition-duration: 0.4s;
        cursor: pointer;
    }

    .centered-button:hover {
        color: white;
    }
</style>
<body>
<div id="wrapper">
    <th:block th:insert="~{/fragments/headerAdmin::header}"/>
    <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom">
            <nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0">
                <div class="navbar-header">
                    <div class="container">
                        <a href="/company/requests" class="centered-button">Request</a>
                    </div>
                </div>
                <ul class="nav navbar-top-links navbar-right">
                </ul>
            </nav>
        </div>
        <div class="navbar-header">
            <div class="form-group" style="display:flex; align-items: center; margin: 10px">
                <input type="text" placeholder="Search Companies" id="keyword"
                       style="width:500px; padding-left:30px; border: 2px solid; margin: 8px">
            </div>
        </div>
        <div class="wrapper wrapper-content animated fadeInRight">
            <div class="row">
                <div class="col-lg-12">
                    <div class="ibox product-detail">
                        <div class="ibox-content">
                            <div class="row">
                                <div class="table-responsive">
                                    <table class="table table-striped" id="companyTable">
                                        <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Picture</th>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Active</th>
                                            <th>Delete</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="/staticAdminManager/js/jquery-3.1.1.min.js"></script>
<script src="/staticAdminManager/js/popper.min.js"></script>
<script src="/staticAdminManager/js/bootstrap.js"></script>
<script src="/staticAdminManager/js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="/staticAdminManager/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
<script src="/staticAdminManager/js/inspinia.js"></script>
<script src="/staticAdminManager/js/plugins/pace/pace.min.js"></script>
<script src="/staticAdminManager/js/plugins/slick/slick.min.js"></script>

<script>
    $(document).ready(function () {
        console.log("Document is ready. Calling loadCompanies.");
        $('.product-images').slick({dots: true});
        loadCompanies();

        $("#keyword").on("input", function () {
            console.log("Keyword input changed. Calling loadCompanies.");
            loadCompanies();
        });
    });

    function loadCompanies() {
        var keyword = $("#keyword").val();
        console.log("Loading companies with keyword:", keyword);

        $.ajax({
            type: "GET",
            url: "/filter/company",
            data: {key: keyword},
            dataType: "json",
            success: function (response) {
                console.log("Companies loaded successfully:", response);
                var companies = response.content;
                $("#companyTable tbody").empty();

                if (companies.length > 0) {
                    $.each(companies, function (index, company) {
                        var row = '<tr>' +
                            '<td>' + company.id + '</td>' +
                            '<td>' + (company.picName ? '<img alt="text" src="/getImage?picName=' + company.picName + '" width="80">' : '<p class="no_img">picture is empty</p>') + '</td>' +
                            '<td>' + company.name + '</td>' +
                            '<td>' + company.email + '</td>' +
                            '<td>' + company.active + '</td>' +
                            '<td><a href="/company/delete/' + company.id + '"><div class="pa bigger-icon"><i class="fa fa-trash" style="color: #000000;"></i></div></a></td>' +
                            '</tr>';
                        $("#companyTable tbody").append(row);
                    });
                } else {
                    $("#companyTable tbody").append('<tr><td colspan="7">No companies found</td></tr>');
                }
            },
            error: function (xhr, status, error) {
                console.error("Error fetching company data:", status, error);
            }
        });
    }
</script>

</body>
</html>